{% comment %}
  Google Map Footer Block
  Embedded Google Maps with customizable settings
{% endcomment %}

<div class="footer-google-map">
  {% if block.settings.heading != blank %}
    <h3>{{ block.settings.heading }}</h3>
  {% endif %}

  {% if block.settings.address != blank %}
    {% assign map_query = block.settings.address | url_encode %}
    {% assign map_height = block.settings.map_height | default: 300 %}
    {% assign map_style = block.settings.map_style | default: 'roadmap' %}
    {% assign zoom_level = block.settings.zoom_level | default: 15 %}
    
    <div class="map-container" style="height: {{ map_height }}px;">
      <iframe
        src="https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q={{ map_query }}&maptype={{ map_style }}&zoom={{ zoom_level }}"
        width="100%" 
        height="{{ map_height }}" 
        style="border:0; border-radius: 8px;" 
        allowfullscreen="" 
        loading="lazy" 
        referrerpolicy="no-referrer-when-downgrade">
      </iframe>
    </div>

    {% comment %} Fallback: Simple Google Maps link if API key not configured {% endcomment %}
    <div class="map-fallback" style="display: none;">
      <div class="map-placeholder" style="height: {{ map_height }}px; background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-direction: column; color: #6c757d;">
        <svg width="48" height="48" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
        </svg>
        <p style="margin: 10px 0 0 0; font-size: 14px;">{{ block.settings.address | newline_to_br }}</p>
      </div>
    </div>

    {% if block.settings.show_directions_link and block.settings.directions_url != blank %}
      <div class="directions-link">
        <a href="{{ block.settings.directions_url }}" target="_blank" class="directions-button">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
          </svg>
          Get Directions
        </a>
      </div>
    {% else %}
      <div class="directions-link">
        <a href="https://maps.google.com/?q={{ map_query }}" target="_blank" class="directions-button">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
          </svg>
          Get Directions
        </a>
      </div>
    {% endif %}
  {% endif %}
</div>

<style>
  .footer-google-map .map-container {
    margin-bottom: 15px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .footer-google-map .directions-link {
    text-align: center;
  }

  .footer-google-map .directions-button {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background-color: #4285f4;
    color: white;
    padding: 10px 20px;
    border-radius: 6px;
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    transition: background-color 0.3s ease;
  }

  .footer-google-map .directions-button:hover {
    background-color: #3367d6;
    color: white;
    text-decoration: none;
  }

  /* Show fallback if iframe fails to load */
  .footer-google-map iframe[src*="YOUR_API_KEY"] + .map-fallback {
    display: block !important;
  }

  .footer-google-map iframe[src*="YOUR_API_KEY"] {
    display: none;
  }
</style>

<script>
  // Check if Google Maps embed is working, show fallback if not
  document.addEventListener('DOMContentLoaded', function() {
    const mapIframes = document.querySelectorAll('.footer-google-map iframe');
    mapIframes.forEach(function(iframe) {
      if (iframe.src.includes('YOUR_API_KEY')) {
        iframe.style.display = 'none';
        const fallback = iframe.parentNode.nextElementSibling;
        if (fallback && fallback.classList.contains('map-fallback')) {
          fallback.style.display = 'block';
        }
      }
    });
  });
</script>