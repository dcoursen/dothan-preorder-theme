{% comment %}
  Smart Store Hours Footer Block
  Automatically groups consecutive days with same hours or closed status
{% endcomment %}

{%- liquid
  # Create array of all days with hours in order (Sun=0, Mon=1, etc.)
  assign days_array = 'sunday,monday,tuesday,wednesday,thursday,friday,saturday' | split: ','
  assign day_names = 'Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday' | split: ','
  assign day_names_short = 'Sun,Mon,Tue,Wed,Thu,Fri,Sat' | split: ','
  
  # Get hours for each day
  assign hours = ''
  assign hours = hours | append: block.settings.sunday | append: '|'
  assign hours = hours | append: block.settings.monday | append: '|' 
  assign hours = hours | append: block.settings.tuesday | append: '|'
  assign hours = hours | append: block.settings.wednesday | append: '|'
  assign hours = hours | append: block.settings.thursday | append: '|'
  assign hours = hours | append: block.settings.friday | append: '|'
  assign hours = hours | append: block.settings.saturday
  assign hours_array = hours | split: '|'
  
  # Create groups
  assign groups = ''
  assign current_group_start = -1
  assign current_group_hours = ''
  assign i = 0
  
  for hour in hours_array
    assign is_closed = false
    if hour contains 'Closed' or hour contains 'closed' or hour == ''
      assign is_closed = true
      assign hour = 'Closed'
    endif
    
    # Start new group if hours changed or first iteration
    if hour != current_group_hours or i == 0
      # Finish previous group if exists
      if current_group_start >= 0
        assign end_index = i | minus: 1
        if current_group_start == end_index
          # Single day
          assign groups = groups | append: day_names[current_group_start] | append: ':' | append: current_group_hours | append: '||'
        else
          # Range of days
          assign groups = groups | append: day_names[current_group_start] | append: '-' | append: day_names[end_index] | append: ':' | append: current_group_hours | append: '||'
        endif
      endif
      
      # Start new group
      assign current_group_start = i
      assign current_group_hours = hour
    endif
    
    # Handle last day
    if i == 6
      if current_group_start == i
        # Single day
        assign groups = groups | append: day_names[current_group_start] | append: ':' | append: current_group_hours | append: '||'
      else
        # Range of days  
        assign groups = groups | append: day_names[current_group_start] | append: '-' | append: day_names[i] | append: ':' | append: current_group_hours | append: '||'
      endif
    endif
    
    assign i = i | plus: 1
  endfor
  
  assign groups_array = groups | split: '||'
-%}

<div class="footer-store-hours">
  {% if block.settings.heading != blank %}
    <h3>{{ block.settings.heading }}</h3>
  {% endif %}

  <div class="hours-list">
    {%- for group in groups_array -%}
      {%- if group != blank -%}
        {%- assign group_parts = group | split: ':' -%}
        {%- assign days_part = group_parts[0] -%}
        {%- assign hours_part = group_parts[1] -%}
        {%- assign is_closed = false -%}
        {%- if hours_part contains 'Closed' or hours_part contains 'closed' -%}
          {%- assign is_closed = true -%}
        {%- endif -%}
        
        <div class="hours-item{% if is_closed %} closed{% endif %}">
          <span class="days">{{ days_part }}:</span>
          <span class="times">{{ hours_part }}</span>
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>
</div>

<style>
  .footer-store-hours .hours-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px;
    color: #495057;
  }

  .footer-store-hours .hours-item.closed {
    color: #6c757d;
  }

  .footer-store-hours .days {
    font-weight: 500;
  }

  .footer-store-hours .times {
    color: #6c757d;
  }
</style>