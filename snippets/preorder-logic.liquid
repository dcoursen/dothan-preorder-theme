{%- comment -%}
  Garden Center Preorder Display Logic
  Based on Retail Savage Identity-Driven Framework
{%- endcomment -%}

{%- liquid
  assign today = 'now' | date: '%s'
  assign drop_date_field = product.metafields.custom.preorder_drop_date
  assign pickup_start_field = product.metafields.custom.preorder_pickup_start
  
  assign show_preorder_info = false
  assign preorder_text = ''
  assign pickup_text = ''
  
  # Check for preorder drop date (regardless of availability)
  if drop_date_field != blank
    assign drop_date = drop_date_field | date: '%s'
    assign days_until_drop = drop_date | minus: today | divided_by: 86400
    
    if days_until_drop > 0
      assign show_preorder_info = true
      
      # Smart date formatting for urgency vs anticipation
      if days_until_drop <= 7
        assign drop_weekday = drop_date_field | date: '%w'
        case drop_weekday
          when '0'
            assign day_name = 'Sunday'
          when '1'
            assign day_name = 'Monday'  
          when '2'
            assign day_name = 'Tuesday'
          when '3'
            assign day_name = 'Wednesday'
          when '4'
            assign day_name = 'Thursday'
          when '5'
            assign day_name = 'Friday'
          when '6'
            assign day_name = 'Saturday'
        endcase
        assign time_with_tz = drop_date_field | date: '%l:%M%p EST'
        assign preorder_text = 'Available this ' | append: day_name | append: ' @ ' | append: time_with_tz
      else
        assign formatted_date = drop_date_field | date: '%B %-d @ %l:%M%p EST'
        assign preorder_text = 'Available ' | append: formatted_date
      endif
    endif
  endif
  
  # Pickup information display
  if pickup_start_field != blank
    assign pickup_start_date = pickup_start_field | date: '%s'
    assign days_until_pickup = pickup_start_date | minus: today | divided_by: 86400
    
    if days_until_pickup <= 7 and days_until_pickup >= 0
      assign pickup_weekday = pickup_start_field | date: '%w'
      case pickup_weekday
        when '0'
          assign pickup_day_name = 'Sunday'
        when '1'
          assign pickup_day_name = 'Monday'  
        when '2'
          assign pickup_day_name = 'Tuesday'
        when '3'
          assign pickup_day_name = 'Wednesday'
        when '4'
          assign pickup_day_name = 'Thursday'
        when '5'
          assign pickup_day_name = 'Friday'
        when '6'
          assign pickup_day_name = 'Saturday'
      endcase
      assign pickup_text = 'this ' | append: pickup_day_name
    else
      assign pickup_text = pickup_start_field | date: '%m/%d/%Y'
    endif
  endif
-%}

{%- comment -%} Display preorder availability for identity reinforcement {%- endcomment -%}
{%- if show_preorder_info and settings.enable_preorder_display != false -%}
  <div class="preorder-info-display" style="margin: 0.5rem 0 1rem 0; padding: 8px 12px; background: rgb(var(--color-background-accent)); border-left: 3px solid rgb(var(--color-accent)); font-size: 0.9rem; color: rgb(var(--color-foreground-heading)); border-radius: 4px;">
    <span class="preorder-icon" style="margin-right: 6px;">ðŸŒ±</span>
    <strong>{{ settings.preorder_info_prefix | default: 'Coming Soon' }}:</strong> {{ preorder_text }}
  </div>
{%- endif -%}

{%- comment -%} Display pickup information {%- endcomment -%}
{%- if pickup_text != blank -%}
  <div class="pickup-start-display" style="margin: 0.25rem 0 1rem 0; font-size: 0.9rem; color: rgb(var(--color-foreground-heading)); line-height: 1.4;">
    <strong>Pickup Begins In-Store:</strong> {{ pickup_text }}
  </div>
{%- endif -%}


